<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GA4 äº’å‹•å¼è¦–è¦ºåŒ–ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function GA4Visualizer() {
      const [users, setUsers] = useState([]);
      const [stats, setStats] = useState({
        sessions: 0,
        engagedSessions: 0,
        bouncedSessions: 0,
        newUsers: 0,
        returningUsers: 0,
        events: 0,
      });
      const [pageStats, setPageStats] = useState({
        home: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
        catalog: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
        shelfA: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
        shelfB: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
        shelfC: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
      });
      const [isPlaying, setIsPlaying] = useState(false);
      const [isPaused, setIsPaused] = useState(false);
      const pauseRef = useRef(false);
      const [eventLog, setEventLog] = useState([]);
      const nextUserId = useRef(0);

      const bounceRate = stats.sessions > 0 ? Math.round((stats.bouncedSessions / stats.sessions) * 100) : 0;
      const engagementRate = stats.sessions > 0 ? Math.round((stats.engagedSessions / stats.sessions) * 100) : 0;
      const totalUsers = stats.newUsers + stats.returningUsers;
      const returnRate = totalUsers > 0 ? Math.round((stats.returningUsers / totalUsers) * 100) : 0;

      const addUser = (isNew = true) => {
        const id = nextUserId.current++;
        const user = {
          id,
          isNew,
          position: "home",
          hasEngaged: false,
          sessionStarted: true,
          isIdle: false,
          visitedPages: { home: false, catalog: false, shelfA: false, shelfB: false, shelfC: false },
          autoPlay: true,
        };
        setUsers((prev) => [...prev, user]);
        
        logEvent(isNew ? "first_visit" : "returning_visit", id);
        logEvent("session_start", id);
        
        setStats((prev) => ({
          ...prev,
          sessions: prev.sessions + 1,
          newUsers: prev.newUsers + (isNew ? 1 : 0),
          returningUsers: prev.returningUsers + (isNew ? 0 : 1),
          events: prev.events + (isNew ? 2 : 1),
        }));
        
        updatePageStats("home", { 
          sessions: 1, 
          newUsers: isNew ? 1 : 0, 
          events: isNew ? 2 : 1 
        });
        
        setTimeout(() => {
          setUsers((prev) =>
            prev.map((u) => (u.id === id ? { ...u, visitedPages: { ...u.visitedPages, home: true } } : u))
          );
        }, 0);
        
        return id;
      };

      const moveUser = (userId, position) => {
        setUsers((prev) =>
          prev.map((u) => {
            if (u.id === userId) {
              const updated = { ...u, position };
              
              if (position === "catalog" && !u.visitedPages.catalog) {
                logEvent("page_view", userId);
                setStats((s) => ({ ...s, events: s.events + 1 }));
                updatePageStats("catalog", { 
                  sessions: 1, 
                  newUsers: u.isNew ? 1 : 0, 
                  events: 1 
                });
                updated.visitedPages = { ...u.visitedPages, catalog: true };
              }
              
              if (position === "shelfA" && !u.visitedPages.shelfA) {
                logEvent("scroll", userId);
                setStats((s) => ({ ...s, events: s.events + 1 }));
                updatePageStats("shelfA", { 
                  sessions: 1, 
                  newUsers: u.isNew ? 1 : 0, 
                  events: 1 
                });
                updated.visitedPages = { ...u.visitedPages, shelfA: true };
                
                if (!u.hasEngaged) {
                  logEvent("user_engagement", userId);
                  setStats((s) => ({ ...s, events: s.events + 1 }));
                  updatePageStats("shelfA", { activeUsers: 1, events: 1 });
                  updated.hasEngaged = true;
                }
              }
              
              if (position === "shelfB" && !u.visitedPages.shelfB) {
                logEvent("scroll", userId);
                setStats((s) => ({ ...s, events: s.events + 1 }));
                updatePageStats("shelfB", { 
                  sessions: 1, 
                  newUsers: u.isNew ? 1 : 0, 
                  events: 1 
                });
                updated.visitedPages = { ...u.visitedPages, shelfB: true };
                
                if (!u.hasEngaged) {
                  logEvent("user_engagement", userId);
                  setStats((s) => ({ ...s, events: s.events + 1 }));
                  updatePageStats("shelfB", { activeUsers: 1, events: 1 });
                  updated.hasEngaged = true;
                }
              }
              
              if (position === "shelfC" && !u.visitedPages.shelfC) {
                logEvent("scroll", userId);
                setStats((s) => ({ ...s, events: s.events + 1 }));
                updatePageStats("shelfC", { 
                  sessions: 1, 
                  newUsers: u.isNew ? 1 : 0, 
                  events: 1 
                });
                updated.visitedPages = { ...u.visitedPages, shelfC: true };
                
                if (!u.hasEngaged) {
                  logEvent("user_engagement", userId);
                  setStats((s) => ({ ...s, events: s.events + 1 }));
                  updatePageStats("shelfC", { activeUsers: 1, events: 1 });
                  updated.hasEngaged = true;
                }
              }
              
              return updated;
            }
            return u;
          })
        );
      };

      const removeUser = (userId) => {
        setUsers((prev) => {
          const user = prev.find(u => u.id === userId);
          if (user) {
            setStats((s) => ({
              ...s,
              engagedSessions: s.engagedSessions + (user.hasEngaged ? 1 : 0),
              bouncedSessions: s.bouncedSessions + (user.hasEngaged ? 0 : 1),
            }));
          }
          return prev.filter((u) => u.id !== userId);
        });
      };

      const setUserIdle = (userId, isIdle) => {
        setUsers((prev) =>
          prev.map((u) => (u.id === userId ? { ...u, isIdle } : u))
        );
      };

      const logEvent = (eventName, userId) => {
        const icons = {
          first_visit: "ğŸ¯",
          returning_visit: "ğŸ”",
          session_start: "ğŸ“‹",
          page_view: "ğŸ“„",
          scroll: "ğŸ“œ",
          user_engagement: "âš¡",
          idle_on_home: "ğŸ’¤",
          idle_on_catalog: "ğŸ’¤",
          idle_on_shelf: "ğŸ’¤",
        };
        setEventLog((prev) => [
          { event: eventName, userId, icon: icons[eventName], time: Date.now() },
          ...prev.slice(0, 9),
        ]);
      };

      const updatePageStats = (page, changes) => {
        setPageStats((prev) => {
          const updated = { ...prev };
          Object.keys(changes).forEach((key) => {
            updated[page][key] = prev[page][key] + changes[key];
          });
          return updated;
        });
      };

      const reset = () => {
        setIsPlaying(false);
        setIsPaused(false);
        pauseRef.current = false;
        setUsers([]);
        setStats({
          sessions: 0,
          engagedSessions: 0,
          bouncedSessions: 0,
          newUsers: 0,
          returningUsers: 0,
          events: 0,
        });
        setPageStats({
          home: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
          catalog: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
          shelfA: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
          shelfB: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
          shelfC: { sessions: 0, activeUsers: 0, newUsers: 0, events: 0 },
        });
        setEventLog([]);
        nextUserId.current = 0;
      };

      const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

      const playDemo = async () => {
        const autoUserIds = users.filter(u => u.autoPlay).map(u => u.id);
        
        if (autoUserIds.length === 0) {
          alert("è«‹å…ˆæ–°å¢ä½¿ç”¨è€…ï¼ˆé»æ“Šã€Œâ• æ–°ä½¿ç”¨è€…ã€æˆ–ã€ŒğŸ” å›è¨ªè€…ã€æŒ‰éˆ•ï¼‰");
          return;
        }

        setIsPlaying(true);
        setIsPaused(false);
        pauseRef.current = false;
        
        for (const userId of autoUserIds) {
          if (pauseRef.current) {
            setIsPaused(true);
            await waitForResume();
            setIsPaused(false);
          }
          await simulateUserBehavior(userId);
          await delay(300);
        }
        
        setIsPlaying(false);
        setIsPaused(false);
      };

      const waitForResume = () => {
        return new Promise((resolve) => {
          const checkPause = setInterval(() => {
            if (!pauseRef.current) {
              clearInterval(checkPause);
              resolve();
            }
          }, 100);
        });
      };

      const togglePause = () => {
        pauseRef.current = !pauseRef.current;
        setIsPaused(!isPaused);
      };

      const simulateUserBehavior = async (userId) => {
        const checkPause = async () => {
          if (pauseRef.current) {
            setIsPaused(true);
            await waitForResume();
            setIsPaused(false);
          }
        };

        await delay(1000);
        
        const behavior = Math.random();
        
        if (behavior < 0.15) {
          await checkPause();
          moveUser(userId, "exit");
          await delay(1400);
        } else if (behavior < 0.25) {
          await checkPause();
          setUserIdle(userId, true);
          logEvent("idle_on_home", userId);
          await delay(3000);
          await checkPause();
          setUserIdle(userId, false);
          moveUser(userId, "exit");
          await delay(1400);
        } else if (behavior < 0.4) {
          await checkPause();
          moveUser(userId, "catalog");
          await delay(1200);
          await checkPause();
          moveUser(userId, "exit");
          await delay(1400);
        } else if (behavior < 0.5) {
          await checkPause();
          moveUser(userId, "catalog");
          await delay(1000);
          await checkPause();
          setUserIdle(userId, true);
          logEvent("idle_on_catalog", userId);
          await delay(3000);
          await checkPause();
          setUserIdle(userId, false);
          moveUser(userId, "exit");
          await delay(1400);
        } else {
          await checkPause();
          moveUser(userId, "catalog");
          await delay(1000);
          
          const numShelves = Math.floor(Math.random() * 3) + 1;
          const shelves = ["shelfA", "shelfB", "shelfC"];
          const shuffled = shelves.sort(() => Math.random() - 0.5);
          
          for (let j = 0; j < numShelves; j++) {
            await checkPause();
            moveUser(userId, shuffled[j]);
            await delay(1000);
            
            if (Math.random() < 0.3) {
              await checkPause();
              setUserIdle(userId, true);
              logEvent("idle_on_shelf", userId);
              await delay(2500);
              await checkPause();
              setUserIdle(userId, false);
            }
            
            await checkPause();
            moveUser(userId, "catalog");
            await delay(800);
          }
          
          await checkPause();
          moveUser(userId, "exit");
          await delay(1400);
        }
        
        removeUser(userId);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-slate-100 p-6">
          <div className="max-w-7xl mx-auto space-y-6">
            
            <div className="text-center">
              <h1 className="text-3xl font-bold text-gray-800">GA4 äº’å‹•å¼è¦–è¦ºåŒ–ç³»çµ±</h1>
              <p className="text-gray-600 mt-2">è¿½è¹¤ä½¿ç”¨è€…å¾é€²å…¥åˆ°äº’å‹•çš„å®Œæ•´æµç¨‹</p>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <StatCard label="å·¥ä½œéšæ®µ" value={stats.sessions} icon="ğŸ“‹" />
              <StatCard label="äº’å‹•å·¥ä½œéšæ®µ" value={stats.engagedSessions} icon="âš¡" />
              <StatCard label="æ–°ä½¿ç”¨è€…" value={stats.newUsers} icon="ğŸ¯" />
              <StatCard label="äº‹ä»¶ç¸½æ•¸" value={stats.events} icon="ğŸ“Š" />
            </div>

            <div className="bg-white/80 backdrop-blur rounded-2xl shadow-xl p-6 relative h-[525px] border">
              
              <div className="absolute left-4 top-1/2 -translate-y-1/2">
                <div className="bg-gradient-to-r from-indigo-200 to-indigo-100 border-2 border-indigo-400 rounded-lg p-4 w-32 h-[260px] flex flex-col items-center justify-center shadow-lg">
                  <div className="text-4xl mb-3">ğŸ </div>
                  <div className="text-base font-bold text-gray-800 mb-2">é¦–é å…¥å£</div>
                  <div className="text-xs text-indigo-700 text-center">session_start<br/>first_visit</div>
                </div>
              </div>

              <div className="absolute left-1/2 -translate-x-1/2 ml-[-140px] top-1/2 -translate-y-1/2">
                <div className="bg-cyan-50 border-2 border-cyan-300 rounded-xl p-4 w-40 h-[280px] flex flex-col justify-center text-center shadow-lg">
                  <div className="text-3xl mb-1">ğŸ—ºï¸</div>
                  <div className="font-bold text-sm text-gray-800">è²¨ç‰©å€</div>
                  <div className="text-xs text-gray-600 mt-1">ç›®éŒ„é é¢</div>
                  <div className="text-xs text-cyan-600 mt-1">page_view</div>
                  <div className="flex gap-2 justify-center mt-2">
                    <div className="w-6 h-6 bg-purple-500 rounded"></div>
                    <div className="w-6 h-6 bg-cyan-500 rounded-full"></div>
                    <div className="w-0 h-0 border-l-[6px] border-r-[6px] border-b-[10px] border-transparent border-b-orange-500"></div>
                  </div>
                </div>
              </div>

              <div className="absolute right-12 top-12">
                <div className="bg-orange-50 border-2 border-orange-300 rounded-xl p-3 w-[235px] h-[143px] flex flex-col justify-center text-center shadow-lg">
                  <div className="text-2xl mb-1">ğŸ›ï¸</div>
                  <div className="font-bold text-sm text-gray-800">è²¨æ¶A</div>
                  <div className="text-xs text-gray-600">å•†å“å­é  #1</div>
                  <div className="text-xs text-orange-600 mt-1">user_engagement</div>
                  <div className="flex gap-2 justify-center mt-2">
                    {[1, 2, 3].map((i) => (
                      <div key={i} className="w-10 h-[30px] bg-gradient-to-b from-orange-400 to-orange-500 rounded-lg flex items-center justify-center text-lg">
                        ğŸ§´
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              <div className="absolute right-12 top-1/2 -translate-y-1/2">
                <div className="bg-green-50 border-2 border-green-300 rounded-xl p-3 w-[235px] h-[143px] flex flex-col justify-center text-center shadow-lg">
                  <div className="text-2xl mb-1">ğŸ›ï¸</div>
                  <div className="font-bold text-sm text-gray-800">è²¨æ¶B</div>
                  <div className="text-xs text-gray-600">å•†å“å­é  #2</div>
                  <div className="text-xs text-green-600 mt-1">user_engagement</div>
                  <div className="flex gap-2 justify-center mt-2">
                    {[1, 2, 3].map((i) => (
                      <div key={i} className="w-10 h-[30px] bg-gradient-to-b from-green-400 to-green-500 rounded-lg flex items-center justify-center text-lg">
                        ğŸ§´
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              <div className="absolute right-12 bottom-12">
                <div className="bg-purple-50 border-2 border-purple-300 rounded-xl p-3 w-[235px] h-[143px] flex flex-col justify-center text-center shadow-lg">
                  <div className="text-2xl mb-1">ğŸ›ï¸</div>
                  <div className="font-bold text-sm text-gray-800">è²¨æ¶C</div>
                  <div className="text-xs text-gray-600">å•†å“å­é  #3</div>
                  <div className="text-xs text-purple-600 mt-1">user_engagement</div>
                  <div className="flex gap-2 justify-center mt-2">
                    {[1, 2, 3].map((i) => (
                      <div key={i} className="w-10 h-[30px] bg-gradient-to-b from-purple-400 to-purple-500 rounded-lg flex items-center justify-center text-lg">
                        ğŸ§´
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              <div className="absolute left-[170px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>
              <div className="absolute left-[250px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>
              <div className="absolute left-[350px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>
              <div className="absolute left-[450px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>
              <div className="absolute left-[550px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>
              <div className="absolute left-[670px] top-1/2 -translate-y-1/2 text-gray-400 text-2xl">â†’</div>

              {users.map((user) => (
                <User key={user.id} user={user} />
              ))}
            </div>

            <div className="flex flex-wrap justify-center gap-3">
              <button
                onClick={() => addUser(true)}
                className="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 transition"
                disabled={isPlaying}
              >
                â• æ–°ä½¿ç”¨è€…
              </button>
              <button
                onClick={() => addUser(false)}
                className="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition"
                disabled={isPlaying}
              >
                ğŸ” å›è¨ªè€…
              </button>
              <button
                onClick={playDemo}
                className="bg-indigo-600 text-white px-5 py-2 rounded-lg shadow hover:bg-indigo-700 transition"
                disabled={isPlaying || users.filter(u => u.autoPlay).length === 0}
              >
                â–¶ï¸ æ’­æ”¾ç¤ºç¯„ ({users.filter(u => u.autoPlay).length})
              </button>
              {isPlaying && (
                <button
                  onClick={togglePause}
                  className={`${isPaused ? 'bg-green-600 hover:bg-green-700' : 'bg-yellow-600 hover:bg-yellow-700'} text-white px-5 py-2 rounded-lg shadow transition`}
                >
                  {isPaused ? 'â–¶ï¸ ç¹¼çºŒ' : 'â¸ï¸ æš«åœ'}
                </button>
              )}
              <button
                onClick={reset}
                className="bg-gray-600 text-white px-4 py-2 rounded-lg shadow hover:bg-gray-700 transition"
              >
                ğŸ”„ é‡ç½®
              </button>
            </div>

            <div className="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 border">
              <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ“ˆ å„é é¢çµ±è¨ˆ</h3>
              <div className="grid grid-cols-3 gap-4">
                <PageStatsCard
                  title="ğŸ  é¦–é "
                  sessions={pageStats.home.sessions}
                  activeUsers={pageStats.home.activeUsers}
                  newUsers={pageStats.home.newUsers}
                  events={pageStats.home.events}
                />
                <PageStatsCard
                  title="ğŸ—ºï¸ ç›®éŒ„"
                  sessions={pageStats.catalog.sessions}
                  activeUsers={pageStats.catalog.activeUsers}
                  newUsers={pageStats.catalog.newUsers}
                  events={pageStats.catalog.events}
                />
                <div className="bg-gray-50 rounded-lg border border-dashed border-gray-300 h-[170px]"></div>
              </div>
              <div className="grid grid-cols-3 gap-4 mt-4">
                <PageStatsCard
                  title="ğŸ›ï¸ è²¨æ¶A"
                  sessions={pageStats.shelfA.sessions}
                  activeUsers={pageStats.shelfA.activeUsers}
                  newUsers={pageStats.shelfA.newUsers}
                  events={pageStats.shelfA.events}
                />
                <PageStatsCard
                  title="ğŸ›ï¸ è²¨æ¶B"
                  sessions={pageStats.shelfB.sessions}
                  activeUsers={pageStats.shelfB.activeUsers}
                  newUsers={pageStats.shelfB.newUsers}
                  events={pageStats.shelfB.events}
                />
                <PageStatsCard
                  title="ğŸ›ï¸ è²¨æ¶C"
                  sessions={pageStats.shelfC.sessions}
                  activeUsers={pageStats.shelfC.activeUsers}
                  newUsers={pageStats.shelfC.newUsers}
                  events={pageStats.shelfC.events}
                />
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              
              <div className="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 border">
                <h3 className="text-lg font-bold text-gray-800 mb-2">ğŸ“Š é€²éšæŒ‡æ¨™</h3>
                <p className="text-xs text-gray-500 mb-4">ï¼ˆå…¨ç«™å±¤ç´šçµ±è¨ˆï¼‰</p>
                <div className="space-y-4">
                  <div>
                    <MetricRow label="è·³å‡ºç‡" value={`${bounceRate}%`} desc="æœªè§¸ç™¼äº’å‹•äº‹ä»¶å³é›¢é–‹çš„æ¯”ä¾‹" />
                    <div className="mt-1 text-xs text-gray-500 font-mono bg-gray-50 p-2 rounded">
                      = (è·³å‡ºå·¥ä½œéšæ®µæ•¸ / ç¸½å·¥ä½œéšæ®µ) Ã— 100%
                      <br/>= ({stats.bouncedSessions} / {stats.sessions}) Ã— 100%
                    </div>
                  </div>
                  <div>
                    <MetricRow label="åƒèˆ‡ç‡" value={`${engagementRate}%`} desc="æœ‰äº’å‹•çš„å·¥ä½œéšæ®µæ¯”ä¾‹" />
                    <div className="mt-1 text-xs text-gray-500 font-mono bg-gray-50 p-2 rounded">
                      = (äº’å‹•å·¥ä½œéšæ®µ / ç¸½å·¥ä½œéšæ®µ) Ã— 100%
                      <br/>= ({stats.engagedSessions} / {stats.sessions}) Ã— 100%
                    </div>
                  </div>
                  <div>
                    <MetricRow label="å›è¨ªç‡" value={`${returnRate}%`} desc="å†æ¬¡è¨ªå•çš„ä½¿ç”¨è€…æ¯”ä¾‹" />
                    <div className="mt-1 text-xs text-gray-500 font-mono bg-gray-50 p-2 rounded">
                      = (å›è¨ªè€… / ç¸½ä½¿ç”¨è€…) Ã— 100%
                      <br/>= ({stats.returningUsers} / {totalUsers}) Ã— 100%
                    </div>
                  </div>
                </div>
              </div>

              <div className="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 border">
                <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ“ äº‹ä»¶æ—¥èªŒ</h3>
                <div className="space-y-2 max-h-[280px] overflow-y-auto">
                  {eventLog.map((log, idx) => (
                    <div key={idx} className="text-sm text-gray-700 flex items-center gap-2">
                      <span>{log.icon}</span>
                      <span className="font-mono text-indigo-600">User{log.userId}</span>
                      <span>â†’</span>
                      <span className="font-semibold">{log.event}</span>
                    </div>
                  ))}
                  {eventLog.length === 0 && (
                    <div className="text-gray-400 text-sm">å°šç„¡äº‹ä»¶...</div>
                  )}
                </div>
              </div>
            </div>

            <div className="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 border">
              <h3 className="text-xl font-bold text-gray-800 mb-4">ğŸ“˜ GA4 äº‹ä»¶èˆ‡æŒ‡æ¨™èªªæ˜</h3>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-2">
                  <TermItem icon="ğŸ“‹" term="session_start" desc="å·¥ä½œéšæ®µé–‹å§‹ï¼Œè¿½è¹¤æ¯æ¬¡è¨ªå•" />
                  <TermItem icon="ğŸ“„" term="page_view" desc="é é¢ç€è¦½ï¼Œè¨˜éŒ„ä½¿ç”¨è€…ç€è¦½çš„é é¢" />
                  <TermItem icon="ğŸ¯" term="first_visit" desc="ç¬¬ä¸€æ¬¡è¨ªå•ï¼ˆåƒ…æ–°ä½¿ç”¨è€…è§¸ç™¼ï¼‰" />
                  <TermItem icon="ğŸ“œ" term="scroll" desc="å‘ä¸‹æ»¾å‹•é” 90%ï¼Œè¡¡é‡å…§å®¹å¸å¼•åŠ›" />
                  <TermItem icon="âš¡" term="user_engagement" desc="å‰æ™¯äº’å‹•è¶…é 10 ç§’æˆ–æœ‰ 2 æ¬¡ä»¥ä¸Šé é¢ç€è¦½" />
                  <TermItem icon="ğŸ’¤" term="é–’ç½®ç‹€æ…‹" desc="ä½¿ç”¨è€…åœç•™åœ¨é é¢ä½†ç„¡å‹•ä½œ" />
                </div>
                <div className="space-y-2">
                  <TermItem icon="ğŸšª" term="è·³å‡ºç‡" desc="æœªè§¸ç™¼ user_engagement çš„å·¥ä½œéšæ®µæ¯”ä¾‹" />
                  <TermItem icon="ğŸ“Š" term="åƒèˆ‡ç‡" desc="æœ‰è§¸ç™¼ user_engagement çš„å·¥ä½œéšæ®µæ¯”ä¾‹" />
                  <TermItem icon="ğŸ”" term="å›è¨ªç‡" desc="å†æ¬¡è¨ªå•çš„ä½¿ç”¨è€…ä½”ç¸½ä½¿ç”¨è€…æ¯”ä¾‹" />
                  <TermItem icon="ğŸ²" term="æ¨¡æ“¬è¡Œç‚º" desc="15% å¿«é€Ÿé›¢é–‹ã€10% é–’ç½®é¦–é ã€15% åƒ…çœ‹ç›®éŒ„ã€10% é–’ç½®ç›®éŒ„ã€50% æ·±åº¦ç€è¦½" />
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function User({ user }) {
      const positions = {
        home: { x: 50, y: 230 },
        catalog: { x: 600, y: 230 },
        shelfA: { x: 770, y: 70 },
        shelfB: { x: 770, y: 230 },
        shelfC: { x: 770, y: 390 },
        exit: { x: 50, y: 230 },
      };

      const pos = positions[user.position];
      const color = user.isNew ? "bg-green-500" : "bg-blue-500";

      return (
        <div
          className="absolute transition-all duration-1000 ease-in-out z-10"
          style={{ left: pos.x, top: pos.y }}
        >
          <div className="relative">
            <div className={`absolute -top-8 left-1/2 -translate-x-1/2 ${color} text-white text-xs px-2 py-1 rounded whitespace-nowrap shadow-md`}>
              {user.isNew ? "æ–°" : "å›è¨ª"}
            </div>
            <div className={`text-4xl ${user.isIdle ? 'opacity-50' : ''}`}>
              {user.isNew ? "ğŸ§â€â™€ï¸" : "ğŸ§â€â™‚ï¸"}
            </div>
            {user.isIdle && (
              <div className="absolute -top-2 -right-4 text-2xl animate-pulse">ğŸ’¤</div>
            )}
            {user.hasEngaged && !user.isIdle && (
              <div className="absolute -top-4 -right-2 text-2xl animate-bounce">âš¡</div>
            )}
          </div>
        </div>
      );
    }

    function StatCard({ label, value, icon }) {
      return (
        <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-lg border text-center">
          <div className="text-2xl mb-1">{icon}</div>
          <div className="text-sm text-gray-600">{label}</div>
          <div className="text-2xl font-bold text-indigo-700">{value}</div>
        </div>
      );
    }

    function MetricRow({ label, value, desc }) {
      return (
        <div className="flex justify-between items-center">
          <div>
            <div className="font-semibold text-gray-800">{label}</div>
            <div className="text-xs text-gray-500">{desc}</div>
          </div>
          <div className="text-xl font-bold text-indigo-700">{value}</div>
        </div>
      );
    }

    function TermItem({ icon, term, desc }) {
      return (
        <div className="flex gap-2">
          <span className="text-xl">{icon}</span>
          <div>
            <span className="font-semibold text-gray-800">{term}</span>
            <span className="text-sm text-gray-600">ï¼š{desc}</span>
          </div>
        </div>
      );
    }

    function PageStatsCard({ title, sessions, activeUsers, newUsers, events }) {
      return (
        <div className="bg-gradient-to-br from-indigo-50 to-white rounded-lg p-5 border border-indigo-100 h-[170px] flex flex-col justify-center hover:shadow-lg transition-shadow">
          <div className="text-center font-bold text-gray-800 mb-4 text-base">{title}</div>
          <div className="space-y-2 text-sm">
            <div className="flex justify-between items-center">
              <span className="text-gray-600">å·¥ä½œéšæ®µ</span>
              <span className="font-semibold text-indigo-700 text-lg">{sessions}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="text-gray-600">æ´»èºä½¿ç”¨è€…</span>
              <span className="font-semibold text-indigo-700 text-lg">{activeUsers}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="text-gray-600">æ–°ä½¿ç”¨è€…</span>
              <span className="font-semibold text-indigo-700 text-lg">{newUsers}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="text-gray-600">äº‹ä»¶æ•¸</span>
              <span className="font-semibold text-indigo-700 text-lg">{events}</span>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<GA4Visualizer />);
  </script>
</body>
</html>